# Локальный прототип приложения для тестирования

Этот документ описывает, как запустить локальный прототип приложения на вашем ноутбуке для тестирования без необходимости в Telegram боте, оплатах и внешних сервисах.

## Требования

- Python 3.8 или выше
- pip (менеджер пакетов Python)
- Браузер для тестирования

## Установка

### 1. Установите зависимости

```bash
pip install -r requirements_local.txt
```

Или используйте виртуальное окружение (рекомендуется):

```bash
python3 -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
pip install -r requirements_local.txt
```

### 2. Настройте переменные окружения (опционально)

Файл `.env.local` уже создан с настройками по умолчанию. При необходимости вы можете его отредактировать.

## Запуск

### Простой способ

Просто запустите скрипт:

```bash
./run_local.sh
```

Скрипт автоматически:
- Проверит наличие Python и зависимостей
- Создаст директорию `local_data/` для баз данных
- Запустит FastAPI сервер на порту 8000
- Запустит HTTP сервер для статики на порту 8080

### Ручной запуск

Если хотите запустить компоненты вручную:

#### 1. Запустите FastAPI сервер

```bash
python3 local_server.py
```

API будет доступен на: http://localhost:8000

#### 2. Запустите HTTP сервер для статики (в другом терминале)

```bash
python3 -m http.server 8080
```

Приложение будет доступно на: http://localhost:8080/tracker.html

## Использование

### Откройте приложение в браузере

Перейдите по адресу: **http://localhost:8080/tracker.html**

### Тестирование

1. **User ID**: Вы можете использовать любой user_id для тестирования:
   - В консоли браузера: `localStorage.setItem('tracker_user_id', '1')`
   - Или откройте DevTools и установите заголовок `X-User-Id` в запросах

2. **Все функции доступны**:
   - ✅ Тренировки и план
   - ✅ Питание
   - ✅ Статистика
   - ✅ Настройки профиля
   - ✅ Напоминания
   - ✅ Цели тренировок
   - ✅ Калькулятор БЖУ

3. **Данные сохраняются локально**:
   - Все данные хранятся в SQLite базах данных в директории `local_data/`
   - При перезапуске данные сохраняются
   - Для очистки просто удалите файлы в `local_data/`

### API Endpoints

API доступен на http://localhost:8000/api/

Основные endpoints:
- `GET /api/health` - проверка работоспособности
- `GET /api/profile` - получение профиля
- `POST /api/profile` - обновление профиля
- `GET /api/workout-plan/today` - план тренировок на сегодня
- `GET /api/stats` - статистика
- `GET /api/goals` - цели пользователя
- `POST /api/goals` - обновление целей
- И другие...

### Проверка работоспособности

Откройте в браузере: http://localhost:8000/api/health

Должен вернуться JSON с информацией о статусе сервера и путях к базам данных.

## Структура данных

Базы данных создаются автоматически в директории `local_data/`:

- `tracker.db` - основные данные (тренировки, питание, планы)
- `workout_state.db` - состояние выполнения упражнений
- `user_settings.db` - настройки пользователей

## Остановка

Нажмите `Ctrl+C` в терминале, где запущен скрипт `run_local.sh`.

Или остановите процессы вручную:
```bash
# Найти процессы
ps aux | grep "local_server.py"
ps aux | grep "http.server"

# Остановить (замените PID на реальные значения)
kill <PID>
```

## Устранение проблем

### Порт уже занят

Если порты 8000 или 8080 заняты, вы можете изменить их:

1. Для FastAPI: отредактируйте `local_server.py`, измените `port=8000` на другой порт
2. Для HTTP сервера: измените в `run_local.sh` порт 8080 на другой

### Ошибки импорта

Убедитесь, что все зависимости установлены:
```bash
pip install -r requirements_local.txt
```

### Базы данных не создаются

Проверьте права доступа к директории. Создайте директорию вручную:
```bash
mkdir -p local_data
chmod 755 local_data
```

### CORS ошибки

Если возникают CORS ошибки, убедитесь, что FastAPI сервер запущен и CORS middleware включен (уже настроен в `local_server.py`).

## Отличия от продакшена

Локальный прототип отличается от продакшен версии:

- ❌ Нет Telegram бота
- ❌ Нет оплат и промокодов
- ❌ Нет внешних API (Yandex STT и т.д.)
- ✅ Все остальные функции работают
- ✅ Данные сохраняются локально
- ✅ Можно тестировать без интернета

## Дополнительная информация

- Все API endpoints работают так же, как в продакшене
- Можно использовать любые user_id для тестирования
- Данные сохраняются между перезапусками
- Для полной очистки удалите директорию `local_data/`

## Поддержка

Если возникли проблемы, проверьте:
1. Логи в терминале где запущен сервер
2. Консоль браузера (F12)
3. Файлы баз данных в `local_data/`
